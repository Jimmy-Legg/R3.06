echo "=== setting up networking ==="

ip address add 172.16.0.5/16 dev eth0
ip address add 172.12.150.254/24 dev eth1

ip link set dev eth0 up
ip link set dev eth1 up 

ip route add default via 172.16.0.1

echo "=== copying files ==="

cp shared/resolv.conf /etc/resolv.conf
cp shared/hosts /etc/hosts
cp shared/sources.list /etc/apt/sources.list

mkdir tests
cp shared/npings/installs.bat /tests/installs
chmod +x /tests/installs
cp shared/npings/r4_tests.bat /tests/test
chmod +x /tests/test
cp shared/npings/r4_npings.bat /tests/npings
chmod +x /tests/npings


iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT

iptables -A FORWARD -p tcp -s 172.16.0.1 --sport 1234 -d 172.12.150.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 172.12.150.1 --sport 1234 -d 172.16.0.1 -j ACCEPT

iptables -A FORWARD -p tcp -s 172.12.150.1 --sport 25 -d 192.168.1.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 192.168.1.1 --sport 25 -d 172.12.150.1 -j ACCEPT

iptables -A FORWARD -p tcp -s 192.168.16.0/20 --sport 1234 -d 172.12.150.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 192.16.32.0/20 --sport 1234 -d 172.12.150.1 -j ACCEPT

iptables -A FORWARD -p tcp -s 192.168.16.0/20 --sport 22 -d 172.12.150.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 192.16.32.0/20 --sport 22 -d 172.12.150.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 172.16.0.1 --sport 22 -d 172.12.150.1 -j ACCEPT
iptables -A FORWARD -p tcp -s 172.12.150.1 --sport 22 -d 172.16.0.1 -j ACCEPT


